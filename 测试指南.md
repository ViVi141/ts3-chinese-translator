# TS3 翻译插件测试指南

本指南将帮助你测试插件是否正常工作。

## 第一步：编译插件

在 MSYS2 MinGW64 终端中：

```bash
cd /path/to/ts3-chinese-translator
scripts/build_msys2.sh
```

编译成功后，你应该看到 `dist/ts3_translator_plugin.dll` 文件。

## 第二步：安装插件

### 方法一：使用安装脚本（推荐）

**Windows 批处理脚本：**
```cmd
scripts\install.bat
```

**PowerShell 脚本：**
```powershell
.\scripts\install.ps1
```

安装脚本会自动：
- ✅ 检测插件文件是否存在
- ✅ 找到 TeamSpeak 3 插件目录
- ✅ 复制插件文件
- ✅ 提供安装确认和备份选项
- ✅ 验证安装结果

### 方法二：手动安装

#### 1. 找到 TeamSpeak 3 插件目录

**Windows 路径：**
```
%APPDATA%\TS3Client\plugins\
```

**完整路径示例：**
```
C:\Users\74738\AppData\Roaming\TS3Client\plugins\
```

**快速打开方法：**
- 按 `Win + R`
- 输入：`%APPDATA%\TS3Client\plugins`
- 回车

#### 2. 复制 DLL 文件

将编译好的 `ts3_translator_plugin.dll` 复制到插件目录。

**在 MSYS2 中可以使用：**
```bash
cp dist/ts3_translator_plugin.dll /c/Users/74738/AppData/Roaming/TS3Client/plugins/
```

**或者手动复制：**
- 在文件管理器中打开插件目录
- 将 `ts3_translator_plugin.dll` 拖拽进去

## 第三步：启用插件

1. **启动 TeamSpeak 3 客户端**

2. **打开插件设置：**
   - 点击菜单：`工具` → `选项`（或 `Tools` → `Options`）
   - 左侧选择：`插件`（或 `Plugins`）

3. **启用插件：**
   - 在插件列表中找到 "TS3 中文翻译插件" 或 "TS3 Chinese Translator"
   - 勾选插件旁边的复选框
   - 点击 `确定` 或 `OK`

4. **如果插件未显示：**
   - 确保 DLL 文件在正确的目录
   - 重启 TeamSpeak 3
   - 检查插件目录权限

## 第四步：测试翻译功能

### 测试 1：检查插件状态

在 TeamSpeak 3 聊天框中输入：
```
/translate status
```

**预期结果：**
应该显示类似：
```
翻译状态: 启用/enabled | 语言: auto -> zh
Translation status: enabled | Language: auto -> zh
```

### 测试 2：测试基本翻译

**方法一：让其他用户发送消息**
1. 让其他用户（或另一个客户端）发送英文消息，例如：
   ```
   Hello, how are you?
   ```

2. **预期结果：**
   你应该在聊天框中看到：
   ```
   [用户名]: Hello, how are you?
   [翻译] [用户名]: 你好，你好吗？
   ```

**方法二：使用测试服务器**
1. 连接到任意 TeamSpeak 服务器
2. 等待其他用户发送消息
3. 观察是否出现翻译结果

### 测试 3：测试命令控制

#### 禁用翻译
```
/translate disable
```
**预期结果：** 显示 "翻译功能已禁用 / Translation disabled"

#### 启用翻译
```
/translate enable
```
**预期结果：** 显示 "翻译功能已启用 / Translation enabled"

#### 设置语言
```
/translate setlang en zh
```
**预期结果：** 显示 "翻译语言设置: en -> zh"

#### 查看状态
```
/translate status
```
**预期结果：** 显示当前翻译状态和语言设置

#### 测试翻译功能（新增）
```
/translate test Hello world
```
**预期结果：** 显示：
```
[测试翻译] 原文: Hello world
[测试翻译] 译文: 你好世界
```

这个命令可以让你直接测试翻译功能，不需要等待其他用户发送消息！

### 测试 4：测试不同语言

#### 设置从英语到中文
```
/translate setlang en zh
```
然后让用户发送英文消息，应该翻译成中文。

#### 设置从日语到中文
```
/translate setlang ja zh
```
然后让用户发送日文消息，应该翻译成中文。

#### 自动检测语言
```
/translate setlang auto zh
```
然后让用户发送任意语言的消息，应该自动检测并翻译成中文。

## 第五步：验证功能

### ✅ 正常工作的标志：

1. **插件加载成功：**
   - 在插件列表中可以看到插件
   - 插件状态显示为"已启用"

2. **命令响应正常：**
   - `/translate status` 能显示状态
   - `/translate enable/disable` 能切换状态
   - `/translate setlang` 能设置语言

3. **翻译功能正常：**
   - 其他用户的消息会自动翻译
   - 翻译结果显示为 `[翻译] 用户名: 翻译文本`
   - 原始消息仍然显示

4. **不会翻译自己的消息：**
   - 自己发送的消息不会出现翻译

### ❌ 常见问题排查：

#### 问题 1：插件未加载
**症状：** 插件列表中看不到插件

**解决方法：**
- 检查 DLL 文件是否在正确的目录
- 检查文件名是否正确（必须是 `.dll` 扩展名）
- 重启 TeamSpeak 3
- 检查 TeamSpeak 3 日志文件（`%APPDATA%\TS3Client\logs\`）

#### 问题 2：翻译不工作
**症状：** 命令正常，但消息不翻译

**解决方法：**
- 检查网络连接（需要访问 Google Translate API）
- 运行 `/translate status` 确认翻译已启用
- 检查防火墙是否阻止了网络请求
- 查看 TeamSpeak 日志中的错误信息

#### 问题 3：翻译结果为空
**症状：** 显示 `[翻译] 用户名:` 但没有翻译文本

**解决方法：**
- 可能是 Google Translate API 返回错误
- 检查网络连接
- 尝试设置明确的源语言：`/translate setlang en zh`

#### 问题 4：编译错误
**症状：** 编译时出现错误

**解决方法：**
- 确保在 MSYS2 MinGW64 终端中编译
- 确保已安装 GCC：`pacman -S mingw-w64-x86_64-gcc`
- 检查代码是否有语法错误

## 第六步：查看日志

如果遇到问题，可以查看 TeamSpeak 3 的日志文件：

**日志位置：**
```
%APPDATA%\TS3Client\logs\
```

**查找相关日志：**
- 查找包含 "PLUGIN" 或 "Translator" 的行
- 查找错误信息

**在 MSYS2 中查看：**
```bash
tail -f /c/Users/74738/AppData/Roaming/TS3Client/logs/client.log
```

## 快速测试清单

- [ ] 编译成功，生成了 `ts3_translator_plugin.dll`
- [ ] DLL 文件已复制到插件目录
- [ ] TeamSpeak 3 已重启
- [ ] 插件在设置中显示并已启用
- [ ] `/translate status` 命令有响应
- [ ] `/translate enable/disable` 命令正常工作
- [ ] `/translate setlang` 命令可以设置语言
- [ ] 其他用户的消息会自动翻译
- [ ] 翻译结果显示正确格式
- [ ] 自己的消息不会被翻译

## 测试场景示例

### 场景 1：基本翻译测试
1. 连接到测试服务器
2. 设置：`/translate setlang en zh`
3. 让其他用户发送：`Hello world`
4. 应该看到：`[翻译] [用户名]: 你好世界`

### 场景 2：多语言测试
1. 设置：`/translate setlang auto zh`
2. 让用户发送不同语言的消息
3. 观察是否能正确翻译

### 场景 3：开关测试
1. `/translate disable` - 禁用翻译
2. 发送消息，应该不翻译
3. `/translate enable` - 启用翻译
4. 发送消息，应该翻译

## 需要帮助？

如果测试中遇到问题：

1. **检查日志文件** - 查看错误信息
2. **验证网络连接** - 确保能访问 Google Translate
3. **检查插件版本** - 确保使用最新编译的版本
4. **重新编译** - 如果修改了代码，重新编译

## 成功标志

如果以下所有项目都正常，说明插件工作正常：

✅ 插件成功加载并启用  
✅ 命令响应正常  
✅ 消息自动翻译  
✅ 翻译结果格式正确  
✅ 不会翻译自己的消息  
✅ 可以启用/禁用翻译  
✅ 可以设置翻译语言  

祝你测试顺利！

